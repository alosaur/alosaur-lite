var c;(function(t){t.Get="GET",t.Post="POST",t.Put="PUT",t.Delete="DELETE",t.Path="PATCH",t.Options="OPTIONS"})(c||(c={}));var p;(function(t){t.Cookie="cookie",t.Context="context",t.Response="response",t.Request="request",t.Query="query",t.RouteParam="route-param",t.Body="body"})(p||(p={}));var m=class{constructor(e){this.request=e}};var d={};function i(){return d.routingControllersMetadataArgsStorage||(d.routingControllersMetadataArgsStorage=new R),d.routingControllersMetadataArgsStorage}var R=class{constructor(){this.controllers=[];this.actions=[];this.params=[]}};var l=(t,e)=>!e||t===e,h=t=>t.split("/").reduce((e,a,r)=>{if(/:[A-Za-z1-9]{1,}/.test(a)){let n=a.replace(":","");e.push({i:r,el:n})}return e},[]),E=t=>t.replace(/\/\:[^/]{1,}/gi,"/[^/]{1,}").replace(/\//g,"\\/"),A=(t,e,a)=>t.filter(r=>r.route.includes("/:")&&l(r.method,a)).find(r=>new RegExp("^"+E(r.route)+"$").test(e)),b=(t,e,a)=>t.find(r=>l(r.method,a)&&r.route===e),y=(t,e,a)=>t.filter(r=>r.regexpRoute&&l(r.method.toString(),a)).find(r=>{let n=new RegExp("^"+r.route);return n.test(e)&&r.regexpRoute.test(e.replace(n,""))});function M(t){return C(t).pathname}var f=new Map;function C(t){return f.has(t)||f.set(t,new URL(t)),f.get(t)}function P(t,e,a){let r=M(a),n={},o=b(t,r,e);if(o||(o=y(t,r,e)),!o&&(o=A(t,r,e),o)){let g=h(o.route),s=r.split("/");g.forEach(u=>{n[u.el]=s[u.i]})}return o?{controllerObject:o.controllerObject,actionObject:o.actionObject,target:o.target,action:o.action,actionMetadata:o.actionMetadata,params:o.params,routeParams:n}:null}async function O(t,e){if(e.params.length==0)return[];let a=[],r=e.params.sort((n,o)=>n.index-o.index);for(let n=0;n<r.length;n++){let o=r[n];switch(o.type){case"query":break;case"cookie":case"body":break;case"request":a.push(t.request);break;case"response":a.push(t.response);break;case"context":a.push(t);break;case"route-param":e.routeParams&&o.name?a.push(e.routeParams[o.name]):a.push(void 0);break;default:a.push(void 0);break}}return a}var k=class{constructor(e){this.settings=e;this._routes=[];this.classes=[];this.metadata=i(),w(this.metadata,this.classes,a=>this._routes.push(a))}async handleRequest(e){let a=new m(e),r=P(this._routes,e.method,e.url);if(r!==null){let n=await O(a,r),o=await r.target[r.action](...n);return new Response(o)}return new Response("404")}};function w(t,e=[],a){t.controllers.forEach(r=>{let n=t.actions.filter(s=>s.target===r.target),o=t.params.filter(s=>s.target===r.target);r.actions=n;let g=new r.object;e.push(g),n.forEach(s=>{s.controller=r;let u="";r.route&&(u+=r.route);let x=s.route instanceof RegExp?s.route:void 0;!x&&s.route&&(u+=s.route),u===""&&(u="/");let j={route:u,regexpRoute:x,target:g,actionObject:s.object,controllerObject:r.target,actionMetadata:s,action:s.method,method:s.type,params:o.filter(S=>S.method===s.method)};a(j)})})}function J(t){return function(e){i().controllers.push({type:"default",object:e,target:e,route:t})}}function X(t){return function(e,a){i().actions.push({type:c.Get,object:e,target:e.constructor,method:a,route:t})}}function Y(t){return function(e,a){i().actions.push({type:c.Post,object:e,target:e.constructor,method:a,route:t})}}function q(t){return function(e,a){i().actions.push({type:c.Put,object:e,target:e.constructor,method:a,route:t})}}function T(t){return function(e,a,r){i().params.push({type:p.RouteParam,target:e.constructor,method:a,index:r,name:t})}}function tt(t){return function(e,a){i().actions.push({type:c.Path,object:e,target:e.constructor,method:a,route:t})}}export{k as App,J as Controller,X as Get,m as HttpContext,R as MetadataArgsStorage,T as Param,p as ParamType,tt as Patch,Y as Post,q as Put,c as RequestMethod,i as getMetadataArgsStorage,w as registerControllers};
